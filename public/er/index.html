<!doctype html>
<!--
WWW SQL Designer, (C) 2005-2015 Ondrej Zara, ondras@zarovi.cz
Version: 2.7
See license.txt for licencing information.
-->
<html>
  <head>
    <title>D2RQ Mapper</title>
    <meta name="viewport" content="initial-scale=1,maximum-scale=1" />
    <meta charset="utf-8" />

    <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Roboto+Condensed:400,300,700">
    <link rel="stylesheet" href="http://netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.min.css">
    <!--
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" />
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap-theme.min.css" />
    -->

    <link rel="stylesheet" media="all" href="/assets/import.self-480a95e32619640c1d101721f1716121b0b1b87480dd039d1d2817bc987121cd.css?body=1" />
    <link rel="stylesheet" media="all" href="/assets/style.self-baf088bf69c3a25661c254202833b971a2e89c8c43c1f39c0ec822eefea00bb3.css?body=1" />

    <script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>

    <link rel="stylesheet" href="https://swisnl.github.io/jQuery-contextMenu/css/screen.css" type="text/css"/>
    <link rel="stylesheet" href="https://swisnl.github.io/jQuery-contextMenu/css/theme.css" type="text/css"/>
    <link rel="stylesheet" href="https://swisnl.github.io/jQuery-contextMenu/css/theme-fixes.css" type="text/css"/>
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.4/styles/github.min.css">
    <link href="https://swisnl.github.io/jQuery-contextMenu/dist/jquery.contextMenu.css" rel="stylesheet" type="text/css" />
    <!--
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
    -->
    <script src="https://swisnl.github.io/jQuery-contextMenu/dist/jquery.contextMenu.js" type="text/javascript"></script>
    <script src="https://swisnl.github.io/jQuery-contextMenu/dist/jquery.ui.position.min.js" type="text/javascript"></script>
    <script src="https://swisnl.github.io/jQuery-contextMenu/js/main.js" type="text/javascript"></script>

    <link rel="stylesheet" href="styles/style.css" media="all" />     
    <!--[if IE 6]><link rel="stylesheet" type="text/css" href="styles/ie6.css" /><![endif]-->
    <!--[if IE 7]><link rel="stylesheet" type="text/css" href="styles/ie7.css" /><![endif]-->
    <link rel="stylesheet" href="styles/print.css" type="text/css" media="print" />
    <!--
    <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/dropbox.js/0.10.2/dropbox.min.js"></script>
    -->

    <script src="js/oz.js"></script>
    <script src="js/config.js"></script>
    <script src="js/globals.js"></script>
    <script src="js/visual.js"></script>
    <script src="js/row.js"></script>
    <script src="js/table.js"></script>
    <script src="js/relation.js"></script>
    <script src="js/key.js"></script>
    <script src="js/rubberband.js"></script>
    <script src="js/map.js"></script>
    <script src="js/toggle.js"></script>
    <script src="js/io.js"></script>
    <script src="js/tablemanager.js"></script>
    <script src="js/rowmanager.js"></script>
    <script src="js/keymanager.js"></script>
    <script src="js/window.js"></script>
    <script src="js/options.js"></script>
    <script src="js/wwwsqldesigner.js"></script>
  </head>

  <body>
    <div id="area"></div>

    <div id="controls">
      <div id="bar">
        <div id="toggle"></div>

        <input type="button" id="saveload" />

        <hr/>

        <input type="button" id="d2rqmapping" />
        <input type="button" id="r2rmlmapping" />
        <input type="button" id="dumpedturtle" />

        <hr/>

        <input type="button" id="aligntables" />
        <input type="button" id="addtable" />
        <input type="button" id="edittable" />
        <input type="button" id="tablekeys" />
        <input type="button" id="removetable" />
        <input type="button" id="cleartables" />
        
        <hr/>
        
        <input type="button" id="addrow" />
        <input type="button" id="editrow" />
        <input type="button" id="uprow" class="small" /><input type="button" id="downrow" class="small"/>
        <input type="button" id="foreigncreate" />
        <input type="button" id="foreignconnect" />
        <input type="button" id="foreigndisconnect" />
        <input type="button" id="removerow" />
        
        <hr/>
        
        <input type="button" id="options" />
	<!--
        <a href="https://github.com/ondras/wwwsqldesigner/wiki" target="_blank"><input type="button" id="docs" value="" /></a>
	-->
        <a href="/menu"><input type="button" id="menu" value="" /></a>
      </div>
      
      <div id="rubberband"></div>
      <div id="minimap"></div>
      <div id="background"></div>

      <!-- popup dialog -->
      <div id="window">
        <div id="windowtitle">
	  <img id="throbber" src="images/throbber.gif" alt="" title="" />
	</div>
        <div id="windowcontent"></div>
        <input type="button" id="windowok" />
        <input type="button" id="windowcancel" />
      </div>
    </div> <!-- #controls -->
    
    <div id="opts">
      <table>
        <tbody>
          <tr>
            <td>
              * <label id="language" for="optionlocale"></label>
            </td>
            <td>
              <select id="optionlocale"><option></option></select>
            </td>
          </tr>
          <tr>
            <td>
              * <label id="db" for="optiondb"></label> 
            </td>
            <td>
              <select id="optiondb"><option></option></select>
            </td>
          </tr>
          <tr>
            <td>
              <label id="snap" for="optionsnap"></label> 
            </td>
            <td>
              <input type="text" size="4" id="optionsnap" />
              <span class="small" id="optionsnapnotice"></span>
            </td>
          </tr>
          <tr>
            <td>
              <label id="pattern" for="optionpattern"></label> 
            </td>
            <td>
              <input type="text" size="6" id="optionpattern" />
              <span class="small" id="optionpatternnotice"></span>
            </td>
          </tr>
          <tr>
            <td>
              <label id="hide" for="optionhide"></label> 
            </td>
            <td>
              <input type="checkbox" id="optionhide" />
            </td>
          </tr>
          <tr>
            <td>
              * <label id="vector" for="optionvector"></label> 
            </td>
            <td>
              <input type="checkbox" id="optionvector" />
            </td>
          </tr>
          <tr>
            <td>
              * <label id="showsize" for="optionshowsize"></label> 
            </td>
            <td>
              <input type="checkbox" id="optionshowsize" />
            </td>
          </tr>
          <tr>
            <td>
              * <label id="showtype" for="optionshowtype"></label> 
            </td>
            <td>
              <input type="checkbox" id="optionshowtype" />
            </td>
          </tr>
        </tbody>
      </table>

      <hr />

      * <span class="small" id="optionsnotice"></span>
    </div> <!-- #opts -->

    <!-- Save / Load dialog (container) -->
    <div id="io">
      <table>
        <tbody>
          <tr>
	    <!-- client -->
            <td style="width:60%">
              <fieldset>
                <legend id="client"></legend>
                <div id="singlerow">
                  <input type="button" id="clientsave" /> 
                  <input type="button" id="clientload" />
                </div>
                <div id="singlerow">
                  <input type="button" id="clientlocalsave" />
                  <input type="button" id="clientlocalload" />
                  <input type="button" id="clientlocallist" />
                </div>
                <div id="singlerow">
                  <input type="button" id="dropboxsave" /><!-- may get hidden by dropBoxInit() -->
                  <input type="button" id="dropboxload" /><!-- may get hidden by dropBoxInit() -->
                  <input type="button" id="dropboxlist" /><!-- may get hidden by dropBoxInit() -->
                </div>
                <hr/>
                <input type="button" id="clientsql" />
              </fieldset>
            </td>
	    <!-- server -->
            <td style="width:40%">
              <fieldset>
                <legend id="server"></legend>
                <label for="backend" id="backendlabel"></label>
		<select id="backend">
		  <option></option>
		</select>
                <hr/>
                <input type="button" id="serversave" /> 
                <input type="button" id="quicksave" /> 
                <input type="button" id="serverload" /> 
                <input type="button" id="serverlist" /> 
                <input type="button" id="serverimport" /> 
              </fieldset>
            </td>
          </tr>
          <tr>
            <td colspan="2">
              <fieldset>
                <legend id="output"></legend>
                <textarea id="textarea" rows="1" cols="1"></textarea><!--modified by javascript later-->
              </fieldset>
            </td>
          </tr>
        </tbody>
      </table>
    </div> <!-- #io -->
    
    <div id="keys">
      <fieldset>
        <legend id="keyslistlabel"></legend> 
        <select id="keyslist"><option></option></select>
        <input type="button" id="keyadd" />
        <input type="button" id="keyremove" />
      </fieldset>
      <fieldset>
        <legend id="keyedit"></legend>
        <table>
          <tbody>
            <tr>
              <td>
                <label for="keytype" id="keytypelabel"></label>
                <select id="keytype"><option></option></select>
              </td>
              <td></td>
              <td>
                <label for="keyname" id="keynamelabel"></label>
                <input type="text" id="keyname" size="10" />
              </td>
            </tr>
            <tr>
              <td colspan="3"><hr/></td>
            </tr>
            <tr>
              <td>
                <label for="keyfields" id="keyfieldslabel"></label><br/>
                <select id="keyfields" size="5" multiple="multiple"><option></option></select>
              </td>
              <td>
                <input type="button" id="keyleft" value="&lt;&lt;" /><br/>
                <input type="button" id="keyright" value="&gt;&gt;" /><br/>
              </td>
              <td>
                <label for="keyavail" id="keyavaillabel"></label><br/>
                <select id="keyavail" size="5" multiple="multiple"><option></option></select>
              </td>
            </tr>
          </tbody>
        </table>
      </fieldset>
    </div> <!-- #keys -->
    
    <div id="table">
      <table>
        <tbody>
          <tr>
            <td>
              <label id="tablenamelabel" for="tablename"></label>
            </td>
            <td>
              <input id="tablename" type="text" />
            </td>
          </tr>
          <tr>
            <td>
              <label id="tablecommentlabel" for="tablecomment"></label> 
            </td>
            <td>
              <textarea rows="5" cols="40" id="tablecomment"></textarea>
            </td>
          </tr>
        </tbody>
      </table>
    </div> <!-- #table -->

    <!-- Modal dialog for Subject Mapping -->
    <div class="modal" id="staticModalSubjectMap" tabindex="-1" role="dialog" aria-labelledby="staticModalLabel" aria-hidden="true" data-show="true" data-keyboard="false" data-backdrop="static"></div>

    <!-- Modal dialog for Predicate-Obejct Mapping -->
    <div class="modal" id="staticModalPredicateObjectMap" tabindex="-1" role="dialog" aria-labelledby="staticModalLabel" aria-hidden="true" data-show="true" data-keyboard="false" data-backdrop="static"></div>
    
    <script type="text/javascript">
    var d = new SQL.Designer();

    $.contextMenu({
      selector: '.sqldesigner-tablename',
      callback: function(key, options) {
	var class_map_id = $(this).attr('data-cmid');
        if (key == "edit") {
	  $.getScript('/ajax/subject_map_dialog/' + class_map_id);
          $('#staticModalSubjectMap').modal();
        } else if (key == "toggle") {
          var id = options.$trigger.attr("id");
          if ($("#" + id).hasClass("disable")) {
            $("#" + id).removeClass("disable");
          } else {
            $("#" + id).addClass("disable");
          }
        } else if (key == "mapping") {
	  var url = '/d2rq_mapping/' + class_map_id + '/by_table';
          window.open(url, "d2rq_mapping", "width=700,height=700,scrollbars=yes");
        } else if (key == "rdf") {
	  var url = '/turtle/' + class_map_id + '/by_table';
          window.open(url, "turtle", "width=700,height=700,scrollbars=yes");
        }
      },
      items: {
        "edit":    {name: "Edit subject mapping"},
        "toggle":  {name: "Include or exclude from mapping"},
        "mapping": {name: "Show D2RQ Mapping of this table"},
        "rdf":     {name: "Show Turtle of this table"}
      }
    });

    $.contextMenu({
      selector: '.sqldesigner-column-row',
      callback: function(key, options) {
	var property_bridge_id = $(this).attr('data-pbid');
        if (key == "edit") {
	  console.log(property_bridge_id);
	  $.getScript('/ajax/predicate_object_map_dialog/' + property_bridge_id);
          $('#staticModalPredicateObjectMap').modal();
        } else if (key == "toggle") {
          var id = options.$trigger.attr("id");
          if ($("#" + id).hasClass("disable")) {
            $("#" + id).removeClass("disable");
          } else {
            $("#" + id).addClass("disable");
          }
        } else if (key == "mapping") {
	  var url = '/d2rq_mapping/' + property_bridge_id + '/by_column';
          window.open(url, "d2rq_mapping", "width=700,height=700,scrollbars=yes");
        } else if (key == "rdf") {
	  var url = '/turtle/' + property_bridge_id + '/by_column';
          window.open(url, "turtle", "width=700,height=700,scrollbars=yes");
        }
      },
      items: {
        "edit":    {name: "Edit predicate-object mapping"},
        "toggle":  {name: "Include or exclude from mapping"},
        "mapping": {name: "Show D2RQ Mapping of this column"},
        "rdf":     {name: "Show Turtle of this column"}
      }
    });
    </script>
  </body>
</html>
